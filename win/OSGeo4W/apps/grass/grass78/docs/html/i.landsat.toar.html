<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>i.landsat.toar - GRASS GIS manual</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="grassdocs.css" type="text/css">
</head>
<body bgcolor="white">
<div id="container">

<a href="index.html"><img src="grass_logo.png" alt="GRASS logo"></a>
<hr class="header">

<h2>NAME</h2>
<em><b>i.landsat.toar</b></em>  - Calculates top-of-atmosphere radiance or reflectance and temperature for Landsat MSS/TM/ETM+/OLI
<h2>KEYWORDS</h2>
<a href="imagery.html">imagery</a>, <a href="topic_radiometric_conversion.html">radiometric conversion</a>, <a href="keywords.html#radiance">radiance</a>, <a href="keywords.html#reflectance">reflectance</a>, <a href="keywords.html#brightness temperature">brightness temperature</a>, <a href="keywords.html#atmospheric correction">atmospheric correction</a>, <a href="keywords.html#satellite">satellite</a>, <a href="keywords.html#Landsat">Landsat</a>
<h2>SYNOPSIS</h2>
<div id="name"><b>i.landsat.toar</b><br></div>
<b>i.landsat.toar --help</b><br>
<div id="synopsis"><b>i.landsat.toar</b> [-<b>rnp</b>] <b>input</b>=<em>basename</em> <b>output</b>=<em>basename</em>  [<b>metfile</b>=<em>name</em>]   [<b>sensor</b>=<em>string</em>]   [<b>method</b>=<em>string</em>]   [<b>date</b>=<em>yyyy-mm-dd</em>]   [<b>sun_elevation</b>=<em>float</em>]   [<b>product_date</b>=<em>yyyy-mm-dd</em>]   [<b>gain</b>=<em>string</em>]   [<b>percent</b>=<em>float</em>]   [<b>pixel</b>=<em>integer</em>]   [<b>rayleigh</b>=<em>float</em>]   [<b>lsatmet</b>=<em>string</em>[,<i>string</i>,...]]   [<b>scale</b>=<em>float</em>]   [--<b>overwrite</b>]  [--<b>help</b>]  [--<b>verbose</b>]  [--<b>quiet</b>]  [--<b>ui</b>] 
</div>

<div id="flags">
<h3>Flags:</h3>
<dl>
<dt><b>-r</b></dt>
<dd>Output at-sensor radiance instead of reflectance for all bands</dd>

<dt><b>-n</b></dt>
<dd>Input raster maps use as extension the number of the band instead the code</dd>

<dt><b>-p</b></dt>
<dd>Print output metadata info</dd>

<dt><b>--overwrite</b></dt>
<dd>Allow output files to overwrite existing files</dd>
<dt><b>--help</b></dt>
<dd>Print usage summary</dd>
<dt><b>--verbose</b></dt>
<dd>Verbose module output</dd>
<dt><b>--quiet</b></dt>
<dd>Quiet module output</dd>
<dt><b>--ui</b></dt>
<dd>Force launching GUI dialog</dd>
</dl>
</div>

<div id="parameters">
<h3>Parameters:</h3>
<dl>
<dt><b>input</b>=<em>basename</em>&nbsp;<b>[required]</b></dt>
<dd>Base name of input raster bands</dd>
<dd>Example: 'B.' for B.1, B.2, ...</dd>

<dt><b>output</b>=<em>basename</em>&nbsp;<b>[required]</b></dt>
<dd>Prefix for output raster maps</dd>
<dd>Example: 'B.toar.' generates B.toar.1, B.toar.2, ...</dd>

<dt><b>metfile</b>=<em>name</em></dt>
<dd>Name of Landsat metadata file (.met or MTL.txt)</dd>

<dt><b>sensor</b>=<em>string</em></dt>
<dd>Spacecraft sensor</dd>
<dd>Required only if 'metfile' not given (recommended for sanity)</dd>
<dd>Options: <em>mss1, mss2, mss3, mss4, mss5, tm4, tm5, tm7, oli8</em></dd>
<dd><b>mss1</b>: Landsat-1 MSS</dd>
<dd><b>mss2</b>: Landsat-2 MSS</dd>
<dd><b>mss3</b>: Landsat-3 MSS</dd>
<dd><b>mss4</b>: Landsat-4 MSS</dd>
<dd><b>mss5</b>: Landsat-5 MSS</dd>
<dd><b>tm4</b>: Landsat-4 TM</dd>
<dd><b>tm5</b>: Landsat-5 TM</dd>
<dd><b>tm7</b>: Landsat-7 ETM+</dd>
<dd><b>oli8</b>: Landsat_8 OLI/TIRS</dd>

<dt><b>method</b>=<em>string</em></dt>
<dd>Atmospheric correction method</dd>
<dd>Options: <em>uncorrected, dos1, dos2, dos2b, dos3, dos4</em></dd>
<dd>Default: <em>uncorrected</em></dd>

<dt><b>date</b>=<em>yyyy-mm-dd</em></dt>
<dd>Image acquisition date (yyyy-mm-dd)</dd>
<dd>Required only if 'metfile' not given</dd>

<dt><b>sun_elevation</b>=<em>float</em></dt>
<dd>Sun elevation in degrees</dd>
<dd>Required only if 'metfile' not given</dd>

<dt><b>product_date</b>=<em>yyyy-mm-dd</em></dt>
<dd>Image creation date (yyyy-mm-dd)</dd>
<dd>Required only if 'metfile' not given</dd>

<dt><b>gain</b>=<em>string</em></dt>
<dd>Gain (H/L) of all Landsat ETM+ bands (1-5,61,62,7,8)</dd>
<dd>Required only if 'metfile' not given</dd>

<dt><b>percent</b>=<em>float</em></dt>
<dd>Percent of solar radiance in path radiance</dd>
<dd>Required only if 'method' is any DOS</dd>
<dd>Default: <em>0.01</em></dd>

<dt><b>pixel</b>=<em>integer</em></dt>
<dd>Minimum pixels to consider digital number as dark object</dd>
<dd>Required only if 'method' is any DOS</dd>
<dd>Default: <em>1000</em></dd>

<dt><b>rayleigh</b>=<em>float</em></dt>
<dd>Rayleigh atmosphere (diffuse sky irradiance)</dd>
<dd>Required only if 'method' is DOS3</dd>
<dd>Default: <em>0.0</em></dd>

<dt><b>lsatmet</b>=<em>string[,<i>string</i>,...]</em></dt>
<dd>return value stored for a given metadata</dd>
<dd>Required only if 'metfile' and -p given</dd>
<dd>Options: <em>number, creation, date, sun_elev, sensor, bands, sunaz, time</em></dd>
<dd><b>number</b>: Landsat Number</dd>
<dd><b>creation</b>: Creation timestamp</dd>
<dd><b>date</b>: Date</dd>
<dd><b>sun_elev</b>: Sun Elevation</dd>
<dd><b>sensor</b>: Sensor</dd>
<dd><b>bands</b>: Bands count</dd>
<dd><b>sunaz</b>: Sun Azimuth Angle</dd>
<dd><b>time</b>: Time</dd>

<dt><b>scale</b>=<em>float</em></dt>
<dd>Scale factor for output</dd>
<dd>Default: <em>1.0</em></dd>

</dl>
</div>
<div class="toc">
<h4 class="toc">Table of contents</h4>
<ul class="toc">
    <li class="toc"><a href="#description" class="toc">DESCRIPTION</a></li>
    <li class="toc"><a href="#uncorrected-at-sensor-values-(method=uncorrected,-default)" class="toc">Uncorrected at-sensor values (method=uncorrected, default)</a></li>
    <li class="toc"><a href="#simplified-at-surface-values-(method=dos[1-4])" class="toc">Simplified at-surface values (method=dos[1-4])</a></li>
    <li class="toc"><a href="#notes" class="toc">NOTES</a>
    <ul class="toc">
        <li class="toc"><a href="#on-landsat-8-metadata-file-" class="toc">On Landsat-8 metadata file </a></li>
        <li class="toc"><a href="#calibration-constants" class="toc">Calibration constants</a></li>
    </ul></li>
    <li class="toc"><a href="#examples" class="toc">EXAMPLES</a>
    <ul class="toc">
        <li class="toc"><a href="#metadata-file-examples" class="toc">Metadata file examples</a></li>
        <li class="toc"><a href="#dos1-example" class="toc">DOS1 example</a></li>
    </ul></li>
    <li class="toc"><a href="#references" class="toc">REFERENCES</a></li>
    <li class="toc"><a href="#see-also" class="toc">SEE ALSO</a></li>
    <li class="toc"><a href="#author" class="toc">AUTHOR</a></li>
</ul>
</div>
<h2><a name="description">DESCRIPTION</a></h2>

<em>i.landsat.toar</em> is used to transform the calibrated digital
number of Landsat imagery products to top-of-atmosphere radiance or
top-of-atmosphere reflectance and temperature (band 6 of the sensors
TM and ETM+). Optionally, it can be used to calculate the at-surface
radiance or reflectance with atmospheric correction (DOS method).

<p>
Usually, to do so the production date, the acquisition date, and the
solar elevation are needed. Moreover, for Landsat-7 ETM+ it is also
needed the gain (high or low) of the nine respective bands.

<p>
Optionally (recommended), the data can be read from metadata file
(.met or MTL.txt) for all Landsat MSS, TM, ETM+ and OLI/TIRS. However,
if the solar elevation is given the value of the metadata file is
overwritten. This is necessary when the data in the .met file is
incorrect or not accurate. Also, if acquisition or production dates are
not found in the metadata file then the command line values are used.

<p>
<b>Attention</b>: Any null value or smaller than QCALmin in the input
raster is set to null in the output raster and it is not included in
the equations.

<h2><a name="uncorrected-at-sensor-values-(method=uncorrected,-default)">Uncorrected at-sensor values (method=uncorrected, default)</a></h2>

The standard geometric and radiometric corrections result in a
calibrated digital number (QCAL = DN) images. To further standardize
the impact of illumination geometry, the QCAL images are first
converted first to at-sensor radiance and then to at-sensor
reflectance. The thermal band is first converted from QCAL to
at-sensor radiance, and then to effective at-sensor temperature in
Kelvin degrees.

<p>
Radiometric calibration converts QCAL to <b>at-sensor radiance</b>, a
radiometric quantity measured in W/(m&sup2; * sr * &micro;m) using the
equations:
<ul>
  <li> gain = (Lmax - Lmin) / (QCALmax - QCALmin)</li>
  <li> bias = Lmin - gain * QCALmin </li>
  <li> radiance = gain * QCAL + bias </li>
</ul>

where, <em>Lmax</em> and <em>Lmin</em> are the calibration constants,
and <em>QCALmax</em> and <em>QCALmin</em> are the highest and the
lowest points of the range of rescaled radiance in QCAL.

<p>
Then, to calculate <b>at-sensor reflectance</b> the equations are:

<ul>
  <li> sun_radiance = [Esun * sin(e)] / (PI * d^2)</li>
  <li> reflectance = radiance / sun_radiance </li>
</ul>

where, <em>d</em> is the earth-sun distance in astronomical
units, <em>e</em> is the solar elevation angle, and <em>Esun</em> is
the mean solar exoatmospheric irradiance in W/(m&sup2; * &micro;m).

<h2><a name="simplified-at-surface-values-(method=dos[1-4])">Simplified at-surface values (method=dos[1-4])</a></h2>

Atmospheric correction and reflectance calibration remove the path
radiance, i.e. the stray light from the atmosphere, and the spectral
effect of solar illumination. To output these simple <b>at-surface
radiance</b> and <b>at-surface reflectance</b>, the equations are (not
for thermal bands):

<ul>
  <li> sun_radiance = TAUv * [Esun * sin(e) * TAUz + Esky] / (PI * d^2) </li>
  <li> radiance_path = radiance_dark - percent * sun_radiance </li>
  <li> radiance = (at-sensor_radiance - radiance_path) </li>
  <li> reflectance = radiance / sun_radiance </li>
</ul>

where, <em>percent</em> is a value between 0.0 and 1.0 (usually
0.01), <em>Esky</em> is the diffuse sky irradiance, <em>TAUz</em> is
the atmospheric transmittance along the path from the sun to the
ground surface, and <em>TAUv</em> is the atmospheric transmittance
along the path from the ground surface to the
sensor. <em>radiance_dark</em> is the at-sensor radiance calculated
from the darkest object, i.e. DN with a least 'dark_parameter'
(usually 1000) pixels for the entire image.

The values are,

<ul>
  <li>DOS1: TAUv = 1.0, TAUz = 1.0 and Esky = 0.0</li>
  <li>DOS2: TAUv = 1.0, Esky = 0.0, and TAUz = sin(e) for all bands
    with maximum wave length less than 1. (i.e. bands 4-6 MSS, 1-4 TM,
    and 1-4 ETM+) other bands TAUz = 1.0</li>
  <li>DOS3: TAUv = exp[-t/cos(sat_zenith)],
    TAUz = exp[-t/sin(e)], Esky = rayleigh</li>
  <li>DOS4: TAUv = exp[-t/cos(sat_zenith)],
    TAUz = exp[-t/sin(e)], Esky = PI * radiance_dark </li>
</ul>

<b>Attention</b>: Output radiance remain untouched (i.e. no set to 0.0
when it is negative) then they are possible negative values. However,
output reflectance is set to 0.0 when is obtained a negative value.

<h2><a name="notes">NOTES</a></h2>

The output raster cell values can be rescaled with the <b>scale</b>
parameter (e.g., with 100 in case of using reflectance output
in <em>i.gensigset</em>).

<h3><a name="on-landsat-8-metadata-file-">On Landsat-8 metadata file </a></h3>

NASA reports a structure of the L1G Metadata file 
(<a href="http://landsat.usgs.gov/documents/LDCM-DFCB-004.pdf">LDCM-DFCB-004.pdf</a>) 
for Landsat Data Continuity Mission (i.e. Landsat-8).

<p>
NASA retains in MIN_MAX_RADIANCE group the necessary information 
to transform Digital Numbers (DN) in radiance values. Then, 
<em>i.landsat.toar</em> replaces the possible standard values with the 
metadata values. The results match with the values reported by the 
metada file in RADIOMETRIC_RESCALING group.

<p>
Also, NASA reports the same values of reflectance for all bands 
in max-min values and in gain-bias values. This is strange that all 
bands have the same range of reflectance. Also, they wrote in the 
web page as to calculate reflectance directly from DN, first with 
RADIOMETRIC_RESCALING values and second divided by sin(sun_elevation).

<p>
This is a simple rescaling 

<ul>
  <li> reflectance = radiance / sun_radiance = (DN * RADIANCE_MULT + RADIANCE_ADD) / sun_radiance</li>
  <li> now reflectance = DN * REFLECTANCE_MULT + REFLECTANCE_ADD </li>
  <li> then REFLECTANCE_MULT = RADIANCE_MULT / sun_radiance </li>
  <li> and REFLECTANCE_ADD = RADIANCE_ADD / sun_radiance </li>
</ul>

<p>
The problem arises when we need ESUN values (not provided) to 
compute sun_radiance and DOS. We assume that REFLECTANCE_MAXIMUM 
corresponds to the RADIANCE_MAXIMUM, then

<ul>
  <li> REFLECTANCE_MAXIMUM / sin(e) = RADIANCE_MAXIMUM / sun_radiance</li>
  <li> Esun = (PI * d^2) * RADIANCE_MAXIMUM / REFLECTANCE_MAXIMUM </li>
</ul>

where <em>d</em> is the earth-sun distance provided by metadata file 
or computed inside the program.

<p>
The <em>i.landsat.toar</em> reverts back the NASA rescaling to continue 
using Lmax, Lmin, and Esun values to compute the constant to convert 
DN to radiance and radiance to reflectance with the "traditional" 
equations and simple atmospheric corrections.

<b>Attention</b>: When MAXIMUM values are not provided,
<em>i.landsat.toar</em> tries to calculate Lmax, Lmin, and Esun from 
RADIOMETRIC_RESCALING (in tests the results were the same).

<h3><a name="calibration-constants">Calibration constants</a></h3>
In verbose mode (flag <b>--verbose</b>), the program write basic
satellite data and the parameters used in the transformations.

<p>
Production date is not an exact value but it is necessary to apply
correct calibration constants, which were changed in the dates:
<ul>
  <li>Landsat-1 MSS: never </li>
  <li>Landsat-2 MSS: July 16, 1975</li>
  <li>Landsat-3 MSS: June 1, 1978</li>
  <li>Landsat-4 MSS: August 26, 1982 and April 1, 1983</li>
  <li>Landsat-4 TM:  August 1, 1983 and January 15, 1984</li>
  <li>Landsat-5 MSS: April 6, 1984 and November 9, 1984</li>
  <li>Landsat-5 TM:  May 4, 2003 and April, 2 2007</li>
  <li>Landsat-7 ETM+: July 1, 2000</li>
  <li>Landsat-8 OLI/TIRS: launched in 2013</li>
</ul>

<h2><a name="examples">EXAMPLES</a></h2>

<h3><a name="metadata-file-examples">Metadata file examples</a></h3>

Transform digital numbers of Landsat-7 ETM+ in band rasters 203_30.1,
203_30.2 [...] to uncorrected at-sensor reflectance in output files
203_30.1_toar, 203_30.2_toar [...] and at-sensor temperature in output
files 293_39.61_toar and 293_39.62_toar:

<div class="code"><pre>
i.landsat.toar input=203_30. output=_toar \
  metfile=p203r030_7x20010620.met
</pre></div>

or

<div class="code"><pre>
i.landsat.toar input=L5121060_06020060714. \
  output=L5121060_06020060714_toar \
  metfile=L5121060_06020060714_MTL.txt
</pre></div>

or

<div class="code"><pre>
i.landsat.toar input=LC80160352013134LGN03_B output=toar \
  metfile=LC80160352013134LGN03_MTL.txt sensor=oli8 date=2013-05-14
</pre></div>

<h3><a name="dos1-example">DOS1 example</a></h3>

DN to reflectance using DOS1:

<div class="code"><pre>
# rename channels or make a copy to match i.landsat.toar's input scheme:
g.copy raster=lsat7_2002_10,lsat7_2002.1
g.copy raster=lsat7_2002_20,lsat7_2002.2
g.copy raster=lsat7_2002_30,lsat7_2002.3
g.copy raster=lsat7_2002_40,lsat7_2002.4
g.copy raster=lsat7_2002_50,lsat7_2002.5
g.copy raster=lsat7_2002_61,lsat7_2002.61
g.copy raster=lsat7_2002_62,lsat7_2002.62
g.copy raster=lsat7_2002_70,lsat7_2002.7
g.copy raster=lsat7_2002_80,lsat7_2002.8
</pre></div>

Calculation of reflectance values from DN using DOS1 (metadata obtained
from <a href="http://www.grassbook.org/wp-content/uploads/ncexternal/landsat/2002/p016r035_7x20020524.met.gz">p016r035_7x20020524.met.gz</a>):

<div class="code"><pre>
i.landsat.toar input=lsat7_2002. output=lsat7_2002_toar. sensor=tm7 \
  method=dos1 date=2002-05-24 sun_elevation=64.7730999 \
  product_date=2004-02-12 gain=HHHLHLHHL
</pre></div>

The resulting Landsat channels are named <tt>lsat7_2002_toar.1 .. lsat7_2002_toar.8</tt>.


<h2><a name="references">REFERENCES</a></h2>

<ul>
  <li>Chander G., B.L. Markham and D.L. Helder, 2009: Remote Sensing of
    Environment, vol. 113</li>

  <li>Chander G.H. and B. Markham, 2003: IEEE Transactions On Geoscience And
    Remote Sensing, vol. 41, no. 11.</li>

  <li>Chavez P.S., jr. 1996: Image-based atmospheric corrections -
    Revisited and Improved. Photogrammetric Engineering and Remote
    Sensing 62(9): 1025-1036.</li>

  <li>Huang et al: At-Satellite Reflectance, 2002: A First Order Normalization
    Of Landsat 7 ETM+ Images.</li>

  <li>R. Irish: <a href="http://landsathandbook.gsfc.nasa.gov/orbit_coverage/">Landsat
      7. Science Data Users Handbook</a>. February 17, 2007; 15 May 2011.</li>

  <li>Markham B.L. and J.L. Barker, 1986: Landsat MSS and TM Post-Calibration
    Dynamic Ranges, Exoatmospheric Reflectances and At-Satellite
    Temperatures. EOSAT Landsat Technical Notes, No. 1.</li>

  <li>Moran M.S., R.D. Jackson, P.N. Slater and P.M. Teillet, 1992: Remote
    Sensing of Environment, vol. 41.</li>

  <li>Song et al, 2001: Classification and Change Detection Using Landsat TM
    Data, When and How to Correct Atmospheric Effects? Remote Sensing
    of Environment, vol. 75.</li>
</ul>

<h2><a name="see-also">SEE ALSO</a></h2>

<em>
  <a href="i.atcorr.html">i.atcorr</a>,
  <a href="i.colors.enhance.html">i.colors.enhance</a>,
  <a href="r.mapcalc.html">r.mapcalc</a>,
  <a href="r.in.gdal.html">r.in.gdal</a>
</em>
<p>
<a href="https://lta.cr.usgs.gov/DD/landsat_dictionary.html">Landsat Data Dictionary</a> by USGS

<h2><a name="author">AUTHOR</a></h2>

E. Jorge Tizado  (ej.tizado unileon es), Dept. Biodiversity and Environmental Management,
University of Le&oacute;n, Spain

<!--
<p>
<i>Last changed: $Date$</i>
--><h2>SOURCE CODE</h2>
<p>Available at: <a href="https://github.com/OSGeo/grass/tree/master/imagery/i.landsat.toar">i.landsat.toar source code</a> (<a href="https://github.com/OSGeo/grass/commits/master/imagery/i.landsat.toar">history</a>)</p>
<hr class="header">
<p>
<a href="index.html">Main index</a> |
<a href="imagery.html">Imagery index</a> |
<a href="topics.html">Topics index</a> |
<a href="keywords.html">Keywords index</a> |
<a href="graphical_index.html">Graphical index</a> |
<a href="full_index.html">Full index</a>
</p>
<p>
&copy; 2003-2021
<a href="http://grass.osgeo.org">GRASS Development Team</a>,
GRASS GIS 7.8.6RC3 Reference Manual
</p>

</div>
</body>
</html>
